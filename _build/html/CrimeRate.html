
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crime Rate Analysis &#8212; Handbook For Data Science</title>
    
  <link href="_static/css/theme.css" rel="stylesheet">
  <link href="_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Handbook For Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="intro.html">
   Handbook For Data Science
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Life Cycle
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="LifeCycle.html">
   Data Science Life Cycle
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Pratical Hands-on skills
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="BostonHousing.html">
   Boston Housing Price Prediction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="LendingClub.html">
   Pratical Hands-on skills
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="AirPollution.html">
   Seoul Air Quality Level Prediction
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Infrastructure
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="Infrastructure.html">
   Infrastructure
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Case Study
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="CaseStudy.html">
   Case Study
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        <a class="dropdown-buttons"
            href="_sources/CrimeRate.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download notebook file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/CrimeRate.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/GSDSAML/HandbookForDatascience"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/GSDSAML/HandbookForDatascience/issues/new?title=Issue%20on%20page%20%2FCrimeRate.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/GSDSAML/HandbookForDatascience/gh-pages?urlpath=tree/_build/html/CrimeRate.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-loading-preparation">
   1. Data loading &amp; preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crime-rate-analysis-with-all-us-data">
   2. Crime Rate Analysis with all US data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-training-data">
     2.1. Prepare training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-a-model-to-predict-crime-rate-of-usa">
     2.2. Build a model to predict crime rate of USA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-interpretation">
     2.3 Model Interpretation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-5-states-w-different-profiles-and-analyzing-them">
   3. Selecting 5 states w/ different profiles and analyzing them
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crime-analysize-for-2-specific-types-of-crimes-homicide-and-property-crime">
   4. Crime Analysize for 2 Specific Types of Crimes Homicide and Property Crime
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#homicide">
     4.1 Homicide
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#property-crime">
     4.2 Property Crime
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Crime Rate Analysis</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-loading-preparation">
   1. Data loading &amp; preparation
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crime-rate-analysis-with-all-us-data">
   2. Crime Rate Analysis with all US data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#prepare-training-data">
     2.1. Prepare training data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#build-a-model-to-predict-crime-rate-of-usa">
     2.2. Build a model to predict crime rate of USA
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#model-interpretation">
     2.3 Model Interpretation
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#selecting-5-states-w-different-profiles-and-analyzing-them">
   3. Selecting 5 states w/ different profiles and analyzing them
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#crime-analysize-for-2-specific-types-of-crimes-homicide-and-property-crime">
   4. Crime Analysize for 2 Specific Types of Crimes Homicide and Property Crime
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#homicide">
     4.1 Homicide
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#property-crime">
     4.2 Property Crime
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="crime-rate-analysis">
<h1>Crime Rate Analysis<a class="headerlink" href="#crime-rate-analysis" title="Permalink to this headline">¶</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">folder</span> <span class="o">=</span> <span class="s2">&quot;./data/crime_rate&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="data-loading-preparation">
<h2>1. Data loading &amp; preparation<a class="headerlink" href="#data-loading-preparation" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Property_crime = burglary + larcency + motor_vehicle_theft</p></li>
<li><p>We will remove these three columns and recalculate total_crime &amp; overall crime rate</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cr_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/estimated_crimes.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">FileNotFoundError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mi">6</span><span class="n">cc5149f2872</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">cr_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/estimated_crimes.csv&quot;</span><span class="p">)</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/util/_decorators.py</span> in <span class="ni">wrapper</span><span class="nt">(*args, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">309</span>                     <span class="n">stacklevel</span><span class="o">=</span><span class="n">stacklevel</span><span class="p">,</span>
<span class="g g-Whitespace">    </span><span class="mi">310</span>                 <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">311</span>             <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">312</span> 
<span class="g g-Whitespace">    </span><span class="mi">313</span>         <span class="k">return</span> <span class="n">wrapper</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">read_csv</span><span class="nt">(filepath_or_buffer, sep, delimiter, header, names, index_col, usecols, squeeze, prefix, mangle_dupe_cols, dtype, engine, converters, true_values, false_values, skipinitialspace, skiprows, skipfooter, nrows, na_values, keep_default_na, na_filter, verbose, skip_blank_lines, parse_dates, infer_datetime_format, keep_date_col, date_parser, dayfirst, cache_dates, iterator, chunksize, compression, thousands, decimal, lineterminator, quotechar, quoting, doublequote, escapechar, comment, encoding, encoding_errors, dialect, error_bad_lines, warn_bad_lines, on_bad_lines, delim_whitespace, low_memory, memory_map, float_precision, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">584</span>     <span class="n">kwds</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwds_defaults</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">585</span> 
<span class="ne">--&gt; </span><span class="mi">586</span>     <span class="k">return</span> <span class="n">_read</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">587</span> 
<span class="g g-Whitespace">    </span><span class="mi">588</span> 

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_read</span><span class="nt">(filepath_or_buffer, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">480</span> 
<span class="g g-Whitespace">    </span><span class="mi">481</span>     <span class="c1"># Create the parser.</span>
<span class="ne">--&gt; </span><span class="mi">482</span>     <span class="n">parser</span> <span class="o">=</span> <span class="n">TextFileReader</span><span class="p">(</span><span class="n">filepath_or_buffer</span><span class="p">,</span> <span class="o">**</span><span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">483</span> 
<span class="g g-Whitespace">    </span><span class="mi">484</span>     <span class="k">if</span> <span class="n">chunksize</span> <span class="ow">or</span> <span class="n">iterator</span><span class="p">:</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">__init__</span><span class="nt">(self, f, engine, **kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">809</span>             <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwds</span><span class="p">[</span><span class="s2">&quot;has_index_names&quot;</span><span class="p">]</span>
<span class="g g-Whitespace">    </span><span class="mi">810</span> 
<span class="ne">--&gt; </span><span class="mi">811</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_engine</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_make_engine</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">engine</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">812</span> 
<span class="g g-Whitespace">    </span><span class="mi">813</span>     <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/readers.py</span> in <span class="ni">_make_engine</span><span class="nt">(self, engine)</span>
<span class="g g-Whitespace">   </span><span class="mi">1038</span>             <span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">1039</span>         <span class="c1"># error: Too many arguments for &quot;ParserBase&quot;</span>
<span class="ne">-&gt; </span><span class="mi">1040</span>         <span class="k">return</span> <span class="n">mapping</span><span class="p">[</span><span class="n">engine</span><span class="p">](</span><span class="bp">self</span><span class="o">.</span><span class="n">f</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">)</span>  <span class="c1"># type: ignore[call-arg]</span>
<span class="g g-Whitespace">   </span><span class="mi">1041</span> 
<span class="g g-Whitespace">   </span><span class="mi">1042</span>     <span class="k">def</span> <span class="nf">_failover_to_python</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/c_parser_wrapper.py</span> in <span class="ni">__init__</span><span class="nt">(self, src, **kwds)</span>
<span class="g g-Whitespace">     </span><span class="mi">49</span> 
<span class="g g-Whitespace">     </span><span class="mi">50</span>         <span class="c1"># open handles</span>
<span class="ne">---&gt; </span><span class="mi">51</span>         <span class="bp">self</span><span class="o">.</span><span class="n">_open_handles</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">kwds</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">52</span>         <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">handles</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
<span class="g g-Whitespace">     </span><span class="mi">53</span> 

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/parsers/base_parser.py</span> in <span class="ni">_open_handles</span><span class="nt">(self, src, kwds)</span>
<span class="g g-Whitespace">    </span><span class="mi">220</span>         <span class="n">Let</span> <span class="n">the</span> <span class="n">readers</span> <span class="nb">open</span> <span class="n">IOHandles</span> <span class="n">after</span> <span class="n">they</span> <span class="n">are</span> <span class="n">done</span> <span class="k">with</span> <span class="n">their</span> <span class="n">potential</span> <span class="n">raises</span><span class="o">.</span>
<span class="g g-Whitespace">    </span><span class="mi">221</span>         <span class="s2">&quot;&quot;&quot;</span>
<span class="ne">--&gt; </span><span class="mi">222</span><span class="s2">         self.handles = get_handle(</span>
<span class="g g-Whitespace">    </span><span class="mi">223</span><span class="s2">             src,</span>
<span class="g g-Whitespace">    </span><span class="mi">224</span><span class="s2">             &quot;r&quot;,</span>

<span class="nn">~/anaconda3/lib/python3.8/site-packages/pandas/io/common.py</span> in <span class="ni">get_handle</span><span class="nt">(path_or_buf, mode, encoding, compression, memory_map, is_text, errors, storage_options)</span>
<span class="g g-Whitespace">    </span><span class="mi">700</span><span class="s2">         if ioargs.encoding and &quot;b&quot; not in ioargs.mode:</span>
<span class="g g-Whitespace">    </span><span class="mi">701</span><span class="s2">             # Encoding</span>
<span class="ne">--&gt; </span><span class="mi">702</span><span class="s2">             handle = open(</span>
<span class="g g-Whitespace">    </span><span class="mi">703</span><span class="s2">                 handle,</span>
<span class="g g-Whitespace">    </span><span class="mi">704</span><span class="s2">                 ioargs.mode,</span>

<span class="ne">FileNotFoundError</span>: [Errno 2] No such file or directory: &#39;./data/crime_rate/estimated_crimes.csv&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cr_data</span> <span class="o">=</span> <span class="n">cr_data</span><span class="p">[</span><span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">2019</span><span class="p">]</span>
<span class="n">cr_data</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;state_name&#39;</span><span class="p">:</span><span class="s1">&#39;state name&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">cr_data</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;burglary&#39;</span><span class="p">,</span> <span class="s1">&#39;larceny&#39;</span><span class="p">,</span> <span class="s1">&#39;motor_vehicle_theft&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;violent_crime&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;homicide&#39;</span><span class="p">]</span> \
                            <span class="o">+</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;robbery&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;aggravated_assault&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;property_crime&#39;</span><span class="p">]</span>
<span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;overall crime rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">cr_data</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cr_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demography</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/demography.csv&quot;</span><span class="p">)</span>
<span class="n">demography</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">demography</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>We will remove all columns with absolute values as we want to estimate crime rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remove_absolute_columns</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">keeps</span><span class="p">):</span>
    <span class="n">rm_cols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">keeps</span> <span class="ow">and</span> <span class="ow">not</span> <span class="s1">&#39;percent&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">rm_cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">clean_column_name</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">cols</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span>
    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span><span class="p">:</span>
        <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;percent!!percentage of&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;percent of&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;percent in &quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>\
            <span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;percent&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39; &#39;</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">new_cols</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">keeps</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;total population&#39;</span><span class="p">]</span>
<span class="n">remove_absolute_columns</span><span class="p">(</span><span class="n">demography</span><span class="p">,</span> <span class="n">keeps</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clean_column_name</span><span class="p">(</span><span class="n">demography</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">demography</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Load economic data</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">economics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/economics.csv&quot;</span><span class="p">)</span>
<span class="n">economics</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">economics</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">remove_absolute_columns</span><span class="p">(</span><span class="n">economics</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;population 16 years and over&#39;</span><span class="p">])</span>
<span class="n">economics</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;percent of civilian labor force&#39;</span><span class="p">,</span><span class="s1">&#39;percent!!income and benefits !!less than $10,000&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;percent!!income and benefits !!$10,000 to $14,999&#39;</span><span class="p">,</span><span class="s1">&#39;percent!!income and benefits !!$15,000 to $24,999&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;percent!!income and benefits !!$25,000 to $34,999&#39;</span><span class="p">,</span><span class="s1">&#39;percent!!income and benefits !!$35,000 to $49,999&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;percent!!income and benefits !!$50,000 to $74,999&#39;</span><span class="p">,</span><span class="s1">&#39;percent!!income and benefits !!$75,000 to $99,999&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;percent!!income and benefits !!$100,000 to $149,999&#39;</span><span class="p">,</span><span class="s1">&#39;percent!!income and benefits !!$150,000 to $199,999&#39;</span><span class="p">,</span>\
            <span class="s1">&#39;percent!!income and benefits !!$200,000 or more&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">clean_column_name</span><span class="p">(</span><span class="n">economics</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">eco_new_names</span> <span class="o">=</span> <span class="p">{</span>
<span class="s1">&#39;income and benefits total households&#39;</span> <span class="p">:</span> <span class="s1">&#39;total inc &amp; bnf&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits less than $10,000&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf lt 10k&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $10,000 to $14,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 10k-14.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $15,000 to $24,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 15k-24.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $25,000 to $34,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 25k-34.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $35,000 to $49,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 35k-49.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $50,000 to $74,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 50k-74.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $75,000 to $99,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 75k-99.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $100,000 to $149,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 100k-149.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $150,000 to $199,999&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 150k-199.9K&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits $200,000 or more&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf 200k or more&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits with earnings&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ earnings&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits with social security&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ social security&#39;</span><span class="p">,</span>
<span class="s1">&#39;income and benefits with retirement income&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ retirement inc&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!income and benefits !!with supplemental security income&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ supplemental security inc&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!income and benefits !!with cash public assistance income&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ cash public assistance inc&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!income and benefits !!with food stamp/snap benefits in the past 12 months&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf w/ food stamp/snap benefits&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!income and benefits !!families&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf families&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!income and benefits !!nonfamily households&#39;</span> <span class="p">:</span> <span class="s1">&#39;inc &amp; bnf nonfamily households&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!civilian noninstitutionalized population&#39;</span><span class="p">:</span><span class="s1">&#39;civilian noninstitutionalized elibible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!civilian noninstitutionalized population under 18 years&#39;</span><span class="p">:</span><span class="s1">&#39;civilian noninstitutionalized u18 elibible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!no health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;no h_ins cvrge&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!civilian noninstitutionalized population 18 to 64 years&#39;</span><span class="p">:</span><span class="s1">&#39;civilian noninstitutionalized 18-64 eligible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force&#39;</span><span class="p">:</span><span class="s1">&#39;in lbr eligible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!employed&#39;</span><span class="p">:</span><span class="s1">&#39;empl eligible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!employed!!with health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;empl w/ h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!employed!!with health insurance coverage!!with private health insurance&#39;</span><span class="p">:</span><span class="s1">&#39;empl w/ private h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!employed!!with health insurance coverage!!with public coverage&#39;</span><span class="p">:</span><span class="s1">&#39;empl w/ public h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!employed!!no health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;empl w/o h_ins cvrge&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!unemployed&#39;</span><span class="p">:</span><span class="s1">&#39;unempl elibible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!unemployed!!with health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;unempl w/ h_ins cvrge&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!unemployed!!with health insurance coverage!!with private health insurance&#39;</span><span class="p">:</span><span class="s1">&#39;unempl w/ private h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!unemployed!!with health insurance coverage!!with public coverage&#39;</span><span class="p">:</span><span class="s1">&#39;unempl w/ public h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!in labor force!!unemployed!!no health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;unempl w/o h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!not in labor force&#39;</span><span class="p">:</span><span class="s1">&#39;not in lbr eligible for h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!not in labor force!!with health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;not in lbr w/ h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!not in labor force!!with health insurance coverage!!with private health insurance&#39;</span><span class="p">:</span><span class="s1">&#39;not in lbr w/ private h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!not in labor force!!with health insurance coverage!!with public coverage&#39;</span><span class="p">:</span><span class="s1">&#39;not in lbr w/ public h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;!!health insurance coverage!!not in labor force!!no health insurance coverage&#39;</span><span class="p">:</span><span class="s1">&#39;not in lbr w/o h_ins&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!all families!!with related children under 18 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (all families &amp; rel children u18)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!all families!!with related children under 18 years!!with related children under 5 years only&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (all families &amp; rel children u5)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!married couple families&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (married)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!married couple families!!with related children under 18 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (married &amp; rel children u18)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!married couple families!!with related children under 18 years!!with related children under 5 years only&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (married &amp; rel children u5)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!families with female householder, no husband present&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (no husband)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!families with female householder, no husband present!!with related children under 18 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (no husband &amp; rel children u18)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!families with female householder, no husband present!!with related children under 18 years!!with related children under 5 years only&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (no husband &amp; rel children u5)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!under 18 years!!related children under 18 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel children u18)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!under 18 years!!related children under 18 years!!related children under 5 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel children u5)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!under 18 years!!related children under 18 years!!related children 5 to 17 years&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel children 5-17)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!18 years and over&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel o18)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!18 years and over!!65 years and over&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel o65)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!people in families&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (rel)&#39;</span><span class="p">,</span>
<span class="s1">&#39;families and people whose income in the past 12 months is below the poverty level!!unrelated individuals 15 years and over&#39;</span><span class="p">:</span> <span class="s1">&#39;fm_pp inc(12m) lt pvt lv (unrel o15)&#39;</span>
<span class="p">}</span>
<span class="n">economics</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">eco_new_names</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Load social characteristic data</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">social</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s2">&quot;/social_characteristics.csv&quot;</span><span class="p">)</span>
<span class="n">social</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">social</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">clean_column_name</span><span class="p">(</span><span class="n">social</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">social</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Merge all together</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_data</span> <span class="o">=</span> <span class="n">cr_data</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state name&#39;</span><span class="p">])</span> \
                    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">demography</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state name&#39;</span><span class="p">]),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">economics</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state name&#39;</span><span class="p">]),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span> \
                    <span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">social</span><span class="o">.</span><span class="n">set_index</span><span class="p">([</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;state name&#39;</span><span class="p">]),</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merged_columns</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">columns</span>
<span class="n">sc</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([])</span>
<span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">merged_columns</span><span class="p">:</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="n">merge_data</span><span class="p">[</span><span class="n">merge_data</span><span class="p">[</span><span class="n">c</span><span class="p">]</span><span class="o">.</span><span class="n">isnull</span><span class="p">()]</span><span class="o">.</span><span class="n">index</span>
    <span class="n">merge_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>1. We look at the data correlation</strong></em></p>
<p>Correlation matrix presents the association of attributes. We can filter out columns which are lowly correlated with the target. Nevertheless, correlation is not causation [1]. For example, as you can see population is highly correlated with all types of crimes. However, can you state that a high crime rate is caused by a large population size?</p>
<p>[1] The book of why, Judea Pearl</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_corr</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">data_corr</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_data_cp</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">merge_data_cp</span><span class="p">[</span><span class="s1">&#39;total crime per 1k population&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_data</span><span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">merge_data</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">merge_data_cp</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;total crime per 1k population&#39;</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Total Crime&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>2. Filter columns w/ threshold</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crime_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;violent_crime&quot;</span><span class="p">,</span><span class="s2">&quot;homicide&quot;</span><span class="p">,</span><span class="s2">&quot;robbery&quot;</span><span class="p">,</span><span class="s2">&quot;aggravated_assault&quot;</span><span class="p">,</span><span class="s2">&quot;property_crime&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="n">data_corr</span><span class="p">[(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)][</span><span class="s1">&#39;total crime&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="crime-rate-analysis-with-all-us-data">
<h2>2. Crime Rate Analysis with all US data<a class="headerlink" href="#crime-rate-analysis-with-all-us-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="prepare-training-data">
<h3>2.1. Prepare training data<a class="headerlink" href="#prepare-training-data" title="Permalink to this headline">¶</a></h3>
<p>Using data from previous year to predict the next year crime rate</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_train_test_data</span><span class="p">(</span><span class="n">selected_data</span><span class="p">):</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">selected_data</span><span class="p">[(</span><span class="n">selected_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2010</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">selected_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2018</span><span class="p">)]</span> \
                            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span> \
                            <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">test_data</span> <span class="o">=</span> <span class="n">selected_data</span><span class="p">[(</span><span class="n">selected_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2018</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">selected_data</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2019</span><span class="p">)]</span> \
                            <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span> \
                            <span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_train_test_label</span><span class="p">(</span><span class="n">target_label</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="s1">&#39;overall crime rate&#39;</span><span class="p">):</span>
    <span class="n">train_label</span> <span class="o">=</span> <span class="n">target_label</span><span class="p">[</span><span class="n">target_label</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">2019</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="n">lb</span><span class="p">]</span>
    <span class="n">test_label</span> <span class="o">=</span> <span class="n">target_label</span><span class="p">[</span><span class="n">target_label</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2019</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])[</span><span class="n">lb</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">train_label</span><span class="p">,</span> <span class="n">test_label</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">extract_label</span><span class="p">(</span><span class="n">merge_data</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="s1">&#39;overall crime rate&#39;</span><span class="p">):</span>
    <span class="n">target_label</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">lb</span><span class="p">]]</span>
    <span class="n">target_label</span> <span class="o">=</span> <span class="n">target_label</span><span class="p">[</span><span class="n">target_label</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">2010</span><span class="p">]</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;state name&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">])</span> 
    <span class="n">target_label</span><span class="p">[</span><span class="n">lb</span><span class="p">]</span> <span class="o">=</span> <span class="n">target_label</span><span class="p">[</span><span class="n">lb</span><span class="p">]</span> <span class="o">*</span> <span class="mi">1000</span>
    <span class="k">return</span> <span class="n">target_label</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;overall crime rate&#39;</span>
<span class="n">skip_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;total crime&#39;</span><span class="p">,</span> <span class="s1">&#39;overall crime rate&#39;</span><span class="p">]</span>
<span class="n">selected_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">crime_names</span> <span class="ow">or</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">skip_columns</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<span class="n">selected_data</span> <span class="o">=</span> <span class="n">merge_data</span><span class="p">[</span><span class="n">selected_features</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">selected_data</span> <span class="o">=</span> <span class="n">selected_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">target_label</span> <span class="o">=</span> <span class="n">extract_label</span><span class="p">(</span><span class="n">merge_data</span><span class="p">)</span>
<span class="n">train_data</span><span class="p">,</span> <span class="n">test_data</span> <span class="o">=</span> <span class="n">get_train_test_data</span><span class="p">(</span><span class="n">selected_data</span><span class="p">)</span>
<span class="n">train_label</span><span class="p">,</span> <span class="n">test_label</span> <span class="o">=</span> <span class="n">get_train_test_label</span><span class="p">(</span><span class="n">target_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="build-a-model-to-predict-crime-rate-of-usa">
<h3>2.2. Build a model to predict crime rate of USA<a class="headerlink" href="#build-a-model-to-predict-crime-rate-of-usa" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">shap</span>
<span class="n">shap</span><span class="o">.</span><span class="n">initjs</span><span class="p">()</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBRegressor</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_absolute_error</span> <span class="k">as</span> <span class="n">mae</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">init_model</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_label</span><span class="p">):</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_label</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model1</span> <span class="o">=</span> <span class="n">init_model</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">train_label</span><span class="p">)</span>
<span class="n">pred</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">test_label</span><span class="p">,</span> <span class="n">pred</span><span class="p">)</span>
<span class="n">acc</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="model-interpretation">
<h3>2.3 Model Interpretation<a class="headerlink" href="#model-interpretation" title="Permalink to this headline">¶</a></h3>
<p><em><strong>Initialize explainer</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">explainer1</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">model1</span><span class="p">)</span>
<span class="n">sh_values</span> <span class="o">=</span> <span class="n">explainer1</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Plotting global summarization</strong></em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">sh_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">beeswarm</span><span class="p">(</span><span class="n">sh_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># you can printout a hierachical tree of feature interaction</span>
<span class="c1"># shap.plots.bar(sh_values, max_display=30, clustering=shap.utils.hclust(test_data, test_label))</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Explanation:</strong></em></p>
<ol class="simple">
<li></li>
<li></li>
<li></li>
<li><p>natural resources, construction, &amp; maintenance occupations. Higher, more crime rate.</p></li>
<li></li>
</ol>
<p>Similar for other factors. You should also check additional resources for more detailed information about each factor.</p>
</div>
</div>
<div class="section" id="selecting-5-states-w-different-profiles-and-analyzing-them">
<h2>3. Selecting 5 states w/ different profiles and analyzing them<a class="headerlink" href="#selecting-5-states-w-different-profiles-and-analyzing-them" title="Permalink to this headline">¶</a></h2>
<p>You don’t need to build separate models for each state as we only has 9 records for each one of them. Instead, using 1 big model that fits all states will be better. States with similar properties will have the same pattern. Therefore, if you really want to make separate models for them, each model should be trained with a cluster of data instead of individual state data.</p>
<p>You only need to select 5 states for task 4.</p>
<p>To select 5 states, you can either clasify them into clusters or using feature similarity methods.</p>
<p>Let’s use K-mean for simplicity</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">sklearn.cluster</span> <span class="kn">import</span> <span class="n">KMeans</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">MinMaxScaler</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">aggregated_data</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;state_abbr&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scaled_data</span> <span class="o">=</span> <span class="n">MinMaxScaler</span><span class="p">()</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">aggregated_data</span><span class="p">)</span>

<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">scaled_data</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
<span class="n">scaled_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">aggregated_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="s1">&#39;x2&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cluster_engine</span> <span class="o">=</span> <span class="n">KMeans</span><span class="p">(</span><span class="n">n_clusters</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">cluster_engine</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
<span class="n">clusters</span> <span class="o">=</span> <span class="n">cluster_engine</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">scaled_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_clusters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">scaled_data</span><span class="p">,</span> <span class="n">clusters</span><span class="p">[:,</span> <span class="n">np</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">aggregated_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span><span class="s1">&#39;cluster&#39;</span><span class="p">])</span>
<span class="n">df_clusters</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_clusters</span><span class="p">[</span><span class="s1">&#39;cluster&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">df_clusters</span> <span class="o">=</span> <span class="n">df_clusters</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df_clusters</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x1&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;x2&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s1">&#39;Set1&#39;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s1">&#39;cluster&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df_clusters</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>State selection:</strong></em>
Based on the clustering result, we can select 5 states as follows:</p>
<ol class="simple">
<li><p>Nevada</p></li>
<li><p>Florida</p></li>
<li><p>Alaska</p></li>
<li><p>Ohio</p></li>
<li><p>Louisiana</p></li>
</ol>
<p>K-mean result may be different at each execution time due to its initialization state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">states</span> <span class="o">=</span> <span class="n">target_label</span><span class="p">[(</span><span class="n">target_label</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2019</span><span class="p">)][</span><span class="s1">&#39;state name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
<span class="n">state_index</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">states</span><span class="p">):</span>
    <span class="n">state_index</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
<span class="n">state_index</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">sh_values</span><span class="p">[</span><span class="mi">27</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">sh_values</span><span class="p">[</span><span class="mi">8</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">sh_values</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">sh_values</span><span class="p">[</span><span class="mi">34</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">waterfall</span><span class="p">(</span><span class="n">sh_values</span><span class="p">[</span><span class="mi">17</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="crime-analysize-for-2-specific-types-of-crimes-homicide-and-property-crime">
<h2>4. Crime Analysize for 2 Specific Types of Crimes Homicide and Property Crime<a class="headerlink" href="#crime-analysize-for-2-specific-types-of-crimes-homicide-and-property-crime" title="Permalink to this headline">¶</a></h2>
<p>As mentioned above, correlation is not causation. Therefore, as of now, we can’t say which causes high crime rates or low crime rates. Therefore, let’s select two types of crimes based on its natural motive for crime: homicide and property_crime.</p>
<div class="section" id="homicide">
<h3>4.1 Homicide<a class="headerlink" href="#homicide" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h_crime_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;total crime&quot;</span><span class="p">,</span><span class="s2">&quot;overall crime rate&quot;</span><span class="p">,</span><span class="s2">&quot;homicide&quot;</span><span class="p">,</span><span class="s2">&quot;violent_crime&quot;</span><span class="p">,</span><span class="s2">&quot;robbery&quot;</span><span class="p">,</span><span class="s2">&quot;aggravated_assault&quot;</span><span class="p">,</span><span class="s2">&quot;property_crime&quot;</span><span class="p">,</span><span class="s2">&quot;burglary&quot;</span><span class="p">,</span><span class="s2">&quot;larceny&quot;</span><span class="p">,</span><span class="s2">&quot;motor_vehicle_theft&quot;</span><span class="p">])</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">data_corr</span><span class="p">[(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;homicide&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;homicide&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)][</span><span class="s1">&#39;homicide&#39;</span><span class="p">]</span>

<span class="n">h_selected_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">h_crime_names</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">h_selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_data_2</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">merge_data_2</span><span class="p">[</span><span class="s1">&#39;homicide_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_data_2</span><span class="p">[</span><span class="s1">&#39;homicide&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">merge_data_2</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
<span class="n">h_selected_data</span> <span class="o">=</span> <span class="n">merge_data</span><span class="p">[</span><span class="n">h_selected_features</span><span class="p">]</span>
<span class="n">h_selected_data</span> <span class="o">=</span> <span class="n">h_selected_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">h_train_data</span><span class="p">,</span> <span class="n">h_test_data</span> <span class="o">=</span> <span class="n">get_train_test_data</span><span class="p">(</span><span class="n">h_selected_data</span><span class="p">)</span>
<span class="n">h_target_label</span> <span class="o">=</span> <span class="n">extract_label</span><span class="p">(</span><span class="n">merge_data_2</span><span class="p">,</span> <span class="s1">&#39;homicide_rate&#39;</span><span class="p">)</span>
<span class="n">h_train_label</span><span class="p">,</span> <span class="n">h_test_label</span> <span class="o">=</span> <span class="n">get_train_test_label</span><span class="p">(</span><span class="n">h_target_label</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="s1">&#39;homicide_rate&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h_model</span> <span class="o">=</span> <span class="n">init_model</span><span class="p">(</span><span class="n">h_train_data</span><span class="p">,</span> <span class="n">h_train_label</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h_pred</span> <span class="o">=</span> <span class="n">h_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">h_test_data</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">h_test_label</span><span class="p">,</span> <span class="n">h_pred</span><span class="p">)</span>
<span class="n">acc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">h_explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">h_model</span><span class="p">)</span>
<span class="n">sh_h_values</span> <span class="o">=</span> <span class="n">h_explainer</span><span class="p">(</span><span class="n">h_test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">sh_h_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">beeswarm</span><span class="p">(</span><span class="n">sh_h_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Explanation:</strong></em></p>
<ol class="simple">
<li><p>As pointed here, non-white people are died from homicide cases more than white.</p>
</li>
<li><p>Labor force. The higher, the less.</p></li>
<li></li>
</ol>
</div>
<div class="section" id="property-crime">
<h3>4.2 Property Crime<a class="headerlink" href="#property-crime" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_crime_names</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="s2">&quot;total crime&quot;</span><span class="p">,</span><span class="s2">&quot;overall crime rate&quot;</span><span class="p">,</span><span class="s2">&quot;violent_crime&quot;</span><span class="p">,</span><span class="s2">&quot;homicide&quot;</span><span class="p">,</span><span class="s2">&quot;robbery&quot;</span><span class="p">,</span><span class="s2">&quot;aggravated_assault&quot;</span><span class="p">,</span><span class="s2">&quot;burglary&quot;</span><span class="p">,</span><span class="s2">&quot;larceny&quot;</span><span class="p">,</span><span class="s2">&quot;motor_vehicle_theft&quot;</span><span class="p">])</span>
<span class="n">columns</span> <span class="o">=</span> <span class="n">data_corr</span><span class="p">[(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;property_crime&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">data_corr</span><span class="p">[</span><span class="s1">&#39;property_crime&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)][</span><span class="s1">&#39;property_crime&#39;</span><span class="p">]</span>

<span class="n">p_selected_features</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">columns</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">p_crime_names</span><span class="p">:</span>
        <span class="k">continue</span>
    <span class="n">p_selected_features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">merge_data_3</span> <span class="o">=</span> <span class="n">merge_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">merge_data_3</span><span class="p">[</span><span class="s1">&#39;property_crime_rate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">merge_data_2</span><span class="p">[</span><span class="s1">&#39;property_crime&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="n">merge_data_2</span><span class="p">[</span><span class="s1">&#39;population&#39;</span><span class="p">]</span>
<span class="n">p_selected_data</span> <span class="o">=</span> <span class="n">merge_data</span><span class="p">[</span><span class="n">p_selected_features</span><span class="p">]</span>
<span class="n">p_selected_data</span> <span class="o">=</span> <span class="n">p_selected_data</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">p_train_data</span><span class="p">,</span> <span class="n">p_test_data</span> <span class="o">=</span> <span class="n">get_train_test_data</span><span class="p">(</span><span class="n">p_selected_data</span><span class="p">)</span>
<span class="n">p_target_label</span> <span class="o">=</span> <span class="n">extract_label</span><span class="p">(</span><span class="n">merge_data_3</span><span class="p">,</span> <span class="s1">&#39;property_crime_rate&#39;</span><span class="p">)</span>
<span class="n">p_train_label</span><span class="p">,</span> <span class="n">p_test_label</span> <span class="o">=</span> <span class="n">get_train_test_label</span><span class="p">(</span><span class="n">p_target_label</span><span class="p">,</span> <span class="n">lb</span><span class="o">=</span><span class="s1">&#39;property_crime_rate&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_model</span> <span class="o">=</span> <span class="n">init_model</span><span class="p">(</span><span class="n">p_train_data</span><span class="p">,</span> <span class="n">p_train_label</span><span class="p">)</span>
<span class="n">p_pred</span> <span class="o">=</span> <span class="n">p_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">p_test_data</span><span class="p">)</span>
<span class="n">acc</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">p_test_label</span><span class="p">,</span> <span class="n">p_pred</span><span class="p">)</span>
<span class="n">acc</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">p_explainer</span> <span class="o">=</span> <span class="n">shap</span><span class="o">.</span><span class="n">Explainer</span><span class="p">(</span><span class="n">p_model</span><span class="p">)</span>
<span class="n">sh_p_values</span> <span class="o">=</span> <span class="n">p_explainer</span><span class="p">(</span><span class="n">p_test_data</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">sh_p_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shap</span><span class="o">.</span><span class="n">plots</span><span class="o">.</span><span class="n">beeswarm</span><span class="p">(</span><span class="n">sh_p_values</span><span class="p">,</span> <span class="n">max_display</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p><em><strong>Explanation:</strong></em></p>
<ol class="simple">
<li><p>Family w/ related children under 5. The higher, the more property crime rate. Surprisingly. Poverty level ~ crime rate</p></li>
<li><p>Percent of unemployed in labor force. It’s a natural factor. The higher, the more property crime rate.</p></li>
<li><p>Similar to 2nd factor.</p></li>
<li><p>inc &amp; benifit from 50 -&gt; 74.9K. Higher, less crime rate. When people have enough money for food and living, they tend not to commit property crime.</p></li>
<li></li>
</ol>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By GSDS AML<br/>
    
        &copy; Copyright 2021.<br/>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>